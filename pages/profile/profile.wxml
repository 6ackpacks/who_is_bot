<!--pages/profile/profile.wxml - NetEase Cloud Music Inspired Layout-->
<view class="profile-container theme-{{currentTheme}}">
  <scroll-view scroll-y class="profile-scroll">

    <!-- é¡¶éƒ¨æ›´å¤šæŒ‰é’® -->
    <view class="top-bar">
      <view class="more-btn" bindtap="showMoreMenu">
        <text class="icon icon-more"></text>
      </view>
    </view>

    <!-- æ²‰æµ¸å¼å¤´éƒ¨èƒŒæ™¯ -->
    <view class="immersive-header">
      <!-- èƒŒæ™¯è£…é¥° -->
      <view class="header-bg-gradient"></view>

      <!-- å¤´åƒå±…ä¸­ -->
      <view class="avatar-section">
        <view class="avatar-ring">
          <image src="{{userInfo.avatar}}" class="avatar-image" mode="aspectFill"></image>
        </view>
      </view>

      <!-- æ˜µç§° -->
      <view class="nickname">{{userInfo.nickname}}</view>

      <!-- ç­‰çº§å’Œç§°å·å¾½ç«  -->
      <view class="badges-row">
        <view class="badge badge-level">
          <text class="badge-text">Lv.{{userInfo.level}}</text>
        </view>
        <view class="badge badge-title">
          <text class="badge-text">{{userInfo.levelName}}</text>
        </view>
      </view>

      <!-- æ•°æ®é¢æ¿ - æ¨ªå‘æ¯›ç»ç’ƒå¡ç‰‡ -->
      <view class="stats-panel">
        <view class="stat-card">
          <view class="stat-value">{{stats.totalJudged}}</view>
          <view class="stat-label">æ€»åˆ¤å®š</view>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-card">
          <view class="stat-value stat-highlight">{{stats.accuracy}}%</view>
          <view class="stat-label">å‡†ç¡®ç‡</view>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-card">
          <view class="stat-value stat-streak">{{stats.streak}}</view>
          <view class="stat-label">è¿èƒœ</view>
        </view>
      </view>
    </view>

    <!-- Icon Buttons è¡Œ -->
    <view class="icon-buttons-row">
      <view class="icon-btn" bindtap="goToHistory">
        <view class="icon-btn-circle">
          <text class="icon icon-chart"></text>
        </view>
        <text class="icon-btn-label">åˆ¤é¢˜è®°å½•</text>
      </view>
      <view class="icon-btn" bindtap="scrollToAchievements">
        <view class="icon-btn-circle">
          <text class="icon icon-trophy"></text>
        </view>
        <text class="icon-btn-label">æˆ‘çš„æˆå°±</text>
      </view>
      <view class="icon-btn" bindtap="goToLeaderboard">
        <view class="icon-btn-circle">
          <text class="icon icon-rank"></text>
        </view>
        <text class="icon-btn-label">æ’è¡Œæ¦œ</text>
      </view>
      <view class="icon-btn" bindtap="handleShare">
        <view class="icon-btn-circle">
          <text class="icon icon-card"></text>
        </view>
        <text class="icon-btn-label">ä¾¦æ¢åç‰‡</text>
      </view>
      <view class="icon-btn" bindtap="showMoreMenu">
        <view class="icon-btn-circle">
          <text class="icon icon-grid"></text>
        </view>
        <text class="icon-btn-label">æ›´å¤š</text>
      </view>
    </view>

    <!-- Tab åˆ‡æ¢å™¨ -->
    <view class="tab-switcher">
      <view class="tab-item {{activeTab === 'history' ? 'tab-active' : ''}}" bindtap="switchTab" data-tab="history">
        <text class="tab-text">åˆ¤å®šè®°å½•</text>
        <view class="tab-indicator"></view>
      </view>
      <view class="tab-item {{activeTab === 'achievements' ? 'tab-active' : ''}}" bindtap="switchTab" data-tab="achievements">
        <text class="tab-text">è£èª‰å‹‹ç« </text>
        <view class="tab-indicator"></view>
      </view>
      <view class="tab-item {{activeTab === 'creator' ? 'tab-active' : ''}}" bindtap="switchTab" data-tab="creator">
        <text class="tab-text">åˆ›ä½œè€…ä¸­å¿ƒ</text>
        <view class="tab-indicator"></view>
      </view>
    </view>

    <!-- Tab å†…å®¹åŒºåŸŸ -->
    <view class="tab-content">

      <!-- åˆ¤å®šè®°å½• Tab -->
      <view wx:if="{{activeTab === 'history'}}" class="content-section">
        <view wx:if="{{recentJudgments.length > 0}}" class="list-container">
          <view wx:for="{{recentJudgments}}" wx:key="id" class="list-item" bindtap="goToDetail" data-id="{{item.id}}">
            <view class="list-icon">
              <text class="icon {{item.isCorrect ? 'icon-check-circle' : 'icon-close-circle'}}"></text>
            </view>
            <view class="list-content">
              <view class="list-title">{{item.contentType === 'text' ? 'æ–‡æœ¬å†…å®¹' : item.contentType === 'image' ? 'å›¾ç‰‡å†…å®¹' : 'è§†é¢‘å†…å®¹'}}</view>
              <view class="list-subtitle">{{item.time}}</view>
            </view>
            <view class="list-status {{item.isCorrect ? 'status-correct' : 'status-wrong'}}">
              {{item.isCorrect ? 'æ­£ç¡®' : 'é”™è¯¯'}}
            </view>
          </view>
        </view>
        <view wx:else class="empty-state">
          <text class="empty-icon">ğŸ“Š</text>
          <text class="empty-text">æš‚æ— åˆ¤å®šè®°å½•</text>
          <text class="empty-hint">å¼€å§‹ä½ çš„ç¬¬ä¸€æ¬¡åˆ¤å®šå§</text>
        </view>
      </view>

      <!-- è£èª‰å‹‹ç«  Tab -->
      <view wx:if="{{activeTab === 'achievements'}}" class="content-section">
        <view class="list-container">
          <view wx:for="{{achievements}}" wx:key="id" class="list-item achievement-item {{item.unlocked ? '' : 'achievement-locked'}}">
            <view class="list-icon achievement-icon {{item.unlocked ? 'icon-unlocked' : 'icon-locked'}}">
              <text class="icon {{item.icon}}"></text>
            </view>
            <view class="list-content">
              <view class="list-title">{{item.name}}</view>
              <view class="list-subtitle">{{item.description}}</view>
            </view>
            <view class="list-status {{item.unlocked ? 'status-unlocked' : 'status-locked'}}">
              {{item.unlocked ? 'å·²è·å¾—' : 'æœªè§£é”'}}
            </view>
          </view>
        </view>
      </view>

      <!-- åˆ›ä½œè€…ä¸­å¿ƒ Tab -->
      <view wx:if="{{activeTab === 'creator'}}" class="content-section">
        <view class="creator-panel">
          <view class="creator-lock-icon">
            <text class="icon icon-lock"></text>
          </view>
          <view class="creator-title">ä¸Šä¼ é€šé“æœªå¼€å¯</view>
          <view class="creator-desc">æƒ³è®©å¤§å®¶çœ‹çœ‹ä½ çš„é«˜ä»¿äººæœºï¼Ÿ</view>
          <view class="creator-desc">è¾¾åˆ° <text class="highlight-text">ç¡…è°·å¤©æ‰</text> ç­‰çº§åè§£é”ä¸Šä¼ æƒé™</view>
          <view class="creator-progress">
            <view class="progress-bar-mini">
              <view class="progress-fill-mini" style="width: {{userInfo.progress}}%"></view>
            </view>
            <text class="progress-text">å½“å‰è¿›åº¦ {{userInfo.progress}}%</text>
          </view>
          <button class="creator-btn" disabled>ç”³è¯·å†…æµ‹èµ„æ ¼</button>
        </view>
      </view>

    </view>

    <!-- é€€å‡ºç™»å½•æŒ‰é’® -->
    <view wx:if="{{isLoggedIn}}" class="logout-section">
      <button class="logout-btn" bindtap="handleLogout">
        <text class="logout-text">é€€å‡ºç™»å½•</text>
      </button>
    </view>

    <!-- åº•éƒ¨å ä½ -->
    <view class="bottom-spacer"></view>

  </scroll-view>

  <!-- æ›´å¤šèœå•å¼¹çª— -->
  <view wx:if="{{showMore}}" class="more-overlay" bindtap="hideMoreMenu">
    <view class="more-menu" catchtap="stopPropagation">
      <view class="more-header">
        <text class="more-title">æ›´å¤šåŠŸèƒ½</text>
        <view class="more-close" bindtap="hideMoreMenu">
          <text class="icon icon-close"></text>
        </view>
      </view>
      <view class="more-items">
        <view class="more-item" bindtap="handleThemeToggle">
          <view class="more-item-icon">
            <text class="icon {{currentTheme === 'dark' ? 'icon-moon' : 'icon-sun'}}"></text>
          </view>
          <view class="more-item-content">
            <text class="more-item-title">{{currentTheme === 'dark' ? 'æš—è‰²æ¨¡å¼' : 'äº®è‰²æ¨¡å¼'}}</text>
            <text class="more-item-desc">åˆ‡æ¢åˆ°{{currentTheme === 'dark' ? 'äº®è‰²' : 'æš—è‰²'}}ä¸»é¢˜</text>
          </view>
        </view>
        <view class="more-item" bindtap="goToSettings">
          <view class="more-item-icon">
            <text class="icon icon-settings"></text>
          </view>
          <view class="more-item-content">
            <text class="more-item-title">è®¾ç½®</text>
            <text class="more-item-desc">ä¸ªæ€§åŒ–è®¾ç½®</text>
          </view>
        </view>
        <view class="more-item" bindtap="goToAbout">
          <view class="more-item-icon">
            <text class="icon icon-info"></text>
          </view>
          <view class="more-item-content">
            <text class="more-item-title">å…³äº</text>
            <text class="more-item-desc">ç‰ˆæœ¬ä¿¡æ¯</text>
          </view>
        </view>
      </view>
    </view>
  </view>

</view>
