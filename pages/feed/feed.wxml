<!--pages/feed/feed.wxml-->
<view class="feed-container">

  <!-- åˆ¤å®šé˜¶æ®µ -->
  <view wx:if="{{viewState === 'judging'}}" class="judging-view">
    <view class="content-card-wrapper">
      <view class="content-card {{showAnimation ? 'card-animate' : ''}}">
        <!-- å¼•å·è£…é¥° -->
        <view class="quote-icon">"</view>

        <!-- å›¾ç‰‡å†…å®¹ -->
        <view wx:if="{{currentItem.type === 'image'}}" class="image-content">
          <image src="{{currentItem.url}}" mode="aspectFill" class="content-image"></image>
          <view class="image-overlay"></view>
          <view class="image-title">{{currentItem.title}}</view>
        </view>

        <!-- æ–‡å­—å†…å®¹ -->
        <view wx:else class="text-content">
          <text class="content-text">{{currentItem.text}}</text>
        </view>
      </view>
    </view>

    <!-- åˆ¤å®šæŒ‰é’® -->
    <view class="judge-buttons">
      <button class="judge-btn judge-btn-ai" data-choice="ai" bindtap="handleJudge">
        <text class="judge-btn-text">é“æ˜¯äººæœº!</text>
      </button>
      <button class="judge-btn judge-btn-human" data-choice="human" bindtap="handleJudge">
        <text class="judge-btn-text">åŒ…çœŸäººçš„!</text>
      </button>
    </view>
  </view>

  <!-- ç»“æœæ­æ™“é˜¶æ®µ -->
  <view wx:if="{{viewState === 'revealed'}}" class="revealed-view">
    <view class="content-card-wrapper">
      <view class="content-card dimmed">
        <!-- å¼•å·è£…é¥° -->
        <view class="quote-icon">"</view>

        <!-- å›¾ç‰‡å†…å®¹ -->
        <view wx:if="{{currentItem.type === 'image'}}" class="image-content">
          <image src="{{currentItem.url}}" mode="aspectFill" class="content-image"></image>
          <view class="image-overlay"></view>
          <view class="image-title">{{currentItem.title}}</view>
        </view>

        <!-- æ–‡å­—å†…å®¹ -->
        <view wx:else class="text-content">
          <text class="content-text">{{currentItem.text}}</text>
        </view>

        <!-- ç»“æœè¦†ç›–å±‚ -->
        <view class="result-overlay">
          <!-- è¿”å›æŒ‰é’® -->
          <view class="back-btn" bindtap="handleBackToJudging">
            <text class="back-icon">â€¹</text>
            <text class="back-text">è¿”å›</text>
          </view>

          <!-- ç»“æœå›¾æ ‡ -->
          <view class="result-icon {{isCorrect ? 'result-correct' : 'result-wrong'}}">
            <text class="result-icon-text">{{isCorrect ? 'âœ“' : 'âœ•'}}</text>
          </view>

          <!-- ç»“æœæ ‡é¢˜ -->
          <view class="result-title">{{isCorrect ? 'æ…§çœ¼å¦‚ç‚¬' : 'é—æ†¾è¯¯åˆ¤'}}</view>

          <!-- ç»“æœè¯´æ˜ -->
          <view class="result-subtitle">
            è¿™æ˜¯ç”± <text class="result-model">{{currentItem.isAi ? currentItem.modelTag : 'Human'}}</text> åˆ›ä½œçš„å†…å®¹
          </view>

          <!-- ç»Ÿè®¡æ¡ -->
          <view class="stats-bar">
            <view class="stats-label">{{currentItem.deceptionRate}}% è®¤ä¸ºæ˜¯AI</view>
            <view class="stats-progress">
              <view class="stats-fill" style="width: {{currentItem.deceptionRate}}%"></view>
            </view>
          </view>

          <!-- æ“ä½œæŒ‰é’® -->
          <view class="result-actions">
            <button class="result-btn result-btn-primary" bindtap="handleViewDetails">
              <text>æŸ¥çœ‹è§£æä¸è®¨è®º</text>
            </button>
            <button class="result-btn result-btn-secondary" bindtap="handleNext">
              <text>è·³è¿‡ï¼Œä¸‹ä¸€é¢˜</text>
            </button>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- è¯¦æƒ…é¡µé¢ -->
  <view wx:if="{{viewState === 'details'}}" class="details-view">
    <!-- å¯¼èˆªæ  -->
    <view class="details-header">
      <view class="details-back" bindtap="handleBackToResult">
        <text class="back-icon">â€¹</text>
        <text class="back-text">è¿”å›</text>
      </view>
      <view class="details-title">çœŸç›¸è§£æ</view>
    </view>

    <scroll-view scroll-y class="details-content">
      <!-- ç»“æœæ‘˜è¦ -->
      <view class="details-summary">
        <view class="summary-header">
          <text class="summary-icon">{{isCorrect ? 'âœ“' : 'âœ•'}}</text>
          <text class="summary-title">{{isCorrect ? 'åˆ¤æ–­æ­£ç¡®' : 'åˆ¤æ–­é”™è¯¯'}}</text>
        </view>
        <view class="summary-text">
          è¯¥å†…å®¹ç¡®å®æ˜¯ <text class="summary-bold">{{currentItem.isAi ? 'AI ç”Ÿæˆ' : 'çœŸäººåˆ›ä½œ'}}</text>
        </view>
      </view>

      <!-- ç»Ÿè®¡æ¡ -->
      <view class="details-stats">
        <view class="stats-labels">
          <text class="stats-label-left">äººæœºæ„Ÿ {{currentItem.deceptionRate}}%</text>
          <text class="stats-label-right">çœŸå®æ„Ÿ {{100 - currentItem.deceptionRate}}%</text>
        </view>
        <view class="stats-bar-full">
          <view class="stats-fill-ai" style="width: {{currentItem.deceptionRate}}%"></view>
          <view class="stats-fill-human"></view>
        </view>
      </view>

      <!-- æä¾›è€…ä¿¡æ¯ -->
      <view class="provider-info">
        <text class="provider-label">æ¥æºæä¾›:</text>
        <view class="provider-badge">
          <image src="https://api.dicebear.com/7.x/avataaars/svg?seed={{currentItem.provider}}" class="provider-avatar"></image>
          <text class="provider-name">{{currentItem.provider}}</text>
        </view>
      </view>

      <!-- è¯¦ç»†è§£é‡Š -->
      <view class="explanation-box">
        <text class="explanation-icon">"</text>
        <view class="explanation-content">
          <view class="explanation-title">é‰´åˆ«è¦ç‚¹</view>
          <text class="explanation-text">{{currentItem.explanation}}</text>
          <view class="explanation-footer">
            <text class="explanation-label">ç”Ÿæˆæ¨¡å‹/æ¥æº</text>
            <text class="explanation-model">{{currentItem.isAi ? currentItem.modelTag : 'Human'}}</text>
          </view>
        </view>
      </view>

      <!-- ç¤¾åŒºè®¨è®º -->
      <view class="comments-section">
        <view class="comments-header">
          <text class="comments-icon">ğŸ’¬</text>
          <text class="comments-title">ç¤¾åŒºè®¨è®º</text>
        </view>

        <view class="comments-list">
          <view wx:for="{{currentItem.comments}}" wx:key="id" class="comment-item">
            <image src="{{item.avatar}}" class="comment-avatar"></image>
            <view class="comment-content">
              <view class="comment-header">
                <text class="comment-user">{{item.user}}</text>
                <view class="comment-likes">
                  <text class="like-icon">â™¥</text>
                  <text class="like-count">{{item.likes}}</text>
                </view>
              </view>
              <text class="comment-text">{{item.text}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- åº•éƒ¨å ä½ -->
      <view class="bottom-spacer"></view>
    </scroll-view>

    <!-- åº•éƒ¨æŒ‰é’® -->
    <view class="details-footer">
      <button class="next-btn" bindtap="handleNext">
        <text>ç»§ç»­æŒ‘æˆ˜ä¸‹ä¸€é¢˜</text>
        <text class="next-arrow">â†’</text>
      </button>
    </view>
  </view>

</view>
