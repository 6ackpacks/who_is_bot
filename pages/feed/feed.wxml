<!--pages/feed/feed.wxml-->
<view class="feed-container">

  <!-- é¡¶éƒ¨åˆ†ç±»åˆ‡æ¢æ ‡ç­¾ -->
  <view class="category-tabs">
    <view class="tabs-wrapper">
      <view class="tab-item {{activeCategory === 'recommended' ? 'tab-active' : ''}}" bindtap="handleCategoryChange" data-category="recommended">
        <text class="tab-text">æ¨è</text>
      </view>
      <view class="tab-divider"></view>
      <view class="tab-item {{activeCategory === 'hardest' ? 'tab-active' : ''}}" bindtap="handleCategoryChange" data-category="hardest">
        <text class="tab-text">å…¨ç½‘æœ€éš¾</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view wx:elif="{{error}}" class="error-container">
    <text class="error-icon">âš ï¸</text>
    <text class="error-text">{{error}}</text>
    <button class="retry-btn" bindtap="loadFeedData">é‡æ–°åŠ è½½</button>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <swiper wx:else class="feed-swiper" vertical duration="300" bindchange="onSwiperChange" current="{{currentIndex}}">
    <swiper-item wx:for="{{displayItems}}" wx:key="id" class="feed-item">

      <!-- è§†é¢‘å†…å®¹ -->
      <block wx:if="{{item.type === 'video'}}">
        <view class="content-wrapper">
          <video
            wx:if="{{item.url}}"
            id="video-{{index}}"
            src="{{item.url}}"
            class="full-video"
            loop
            autoplay="{{index === currentIndex}}"
            controls="{{false}}"
            object-fit="cover"
            bindtap="toggleVideoPlay"
          ></video>
        </view>
      </block>

      <!-- å›¾ç‰‡å†…å®¹ -->
      <block wx:elif="{{item.type === 'image'}}">
        <view class="content-wrapper">
          <image src="{{item.url}}" mode="aspectFill" class="full-image"></image>
        </view>
      </block>

      <!-- æ–‡æœ¬å†…å®¹ -->
      <block wx:else>
        <view class="content-wrapper text-content">
          <view class="text-content-card">
            <view class="quote-icon">"</view>
            <text class="text-content-body">{{item.text}}</text>
          </view>
        </view>
      </block>

      <!-- æ¸å˜é®ç½© -->
      <view class="gradient-overlay"></view>

      <!-- åº•éƒ¨ä¿¡æ¯ -->
      <view class="content-info">
        <view class="info-tags">
          <view class="tag-type">{{item.type}}</view>
          <text class="tag-provider">@{{item.provider}}</text>
        </view>
        <view class="info-title">{{item.title}}</view>
        <view class="info-subtitle">
          {{viewState === 'judging' ? 'ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è¿›è¡Œåˆ¤å®š...' : 'åˆ¤å®šå®Œæˆï¼Œç‚¹å‡»æŸ¥çœ‹è§£æ'}}
        </view>
      </view>

    </swiper-item>
  </swiper>

  <!-- åˆ¤å®šæŒ‰é’®ï¼ˆä»…åœ¨judgingçŠ¶æ€æ˜¾ç¤ºï¼‰ -->
  <view wx:if="{{viewState === 'judging'}}" class="judgment-buttons">
    <view class="btn-wrapper">
      <view class="btn-circle btn-ai" bindtap="handleJudge" data-choice="ai">
        <text class="btn-icon">âœ•</text>
      </view>
      <text class="btn-label">é“æ˜¯äººæœº</text>
    </view>
    <view class="btn-wrapper">
      <view class="btn-circle btn-human" bindtap="handleJudge" data-choice="human">
        <text class="btn-icon">â™¥</text>
      </view>
      <text class="btn-label">åŒ…çœŸäººçš„</text>
    </view>
  </view>

  <!-- ç»“æœè´´çº¸ï¼ˆrevealedçŠ¶æ€æ˜¾ç¤ºï¼‰ -->
  <view wx:if="{{viewState === 'revealed' && !showDetails}}" class="result-sticker">
    <view class="sticker-accent"></view>
    <view class="sticker-content">
      <view class="sticker-header">
        <text class="sticker-title {{isCorrect ? 'title-correct' : 'title-wrong'}}">
          {{isCorrect ? 'Bingo! æ…§çœ¼å¦‚ç‚¬' : 'Oops! çœ‹èµ°çœ¼äº†'}}
        </text>
      </view>
      <text class="sticker-explanation">{{currentItem.explanation}}</text>
      <view class="sticker-actions">
        <view class="sticker-btn sticker-btn-primary" bindtap="toggleDetails">
          <text class="btn-icon-small">ğŸ’¬</text>
          <text>æŸ¥çœ‹è¯„è®º & æ·±åº¦è§£æ</text>
        </view>
        <view class="sticker-btn sticker-btn-next" bindtap="handleNext">
          <text class="next-icon">â€º</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è¯¦æƒ…æŠ½å±‰ï¼ˆåŠå±ï¼‰ -->
  <view wx:if="{{showDetails}}" class="details-drawer {{showDetails ? 'drawer-show' : ''}}">
    <!-- èƒŒæ™¯é®ç½© -->
    <view class="drawer-mask" bindtap="toggleDetails"></view>

    <!-- æŠ½å±‰å†…å®¹ -->
    <view class="drawer-content">
      <!-- æ‹–åŠ¨æ‰‹æŸ„ -->
      <view class="drawer-handle" bindtap="toggleDetails">
        <view class="handle-bar"></view>
      </view>

      <!-- æ»šåŠ¨å†…å®¹ -->
      <scroll-view scroll-y class="drawer-scroll">
        <!-- çŠ¶æ€æ ‡é¢˜ -->
        <view class="drawer-header">
          <text class="drawer-title">çœŸç›¸æ¡£æ¡ˆ</text>
          <view class="status-badge {{currentItem.isAi ? 'badge-ai' : 'badge-human'}}">
            {{currentItem.isAi ? 'AI ç”Ÿæˆ' : 'çœŸäººåˆ›ä½œ'}}
          </view>
        </view>

        <!-- æ¨¡å‹ä¿¡æ¯ -->
        <view class="model-info-card">
          <view class="model-info-left">
            <text class="model-label">æ¥æº/æ¨¡å‹</text>
            <text class="model-name">{{currentItem.modelTag}}</text>
          </view>
          <view class="model-info-right">
            <text class="model-label">è¯¯åˆ¤ç‡</text>
            <text class="model-rate">{{currentItem.deceptionRate}}%</text>
          </view>
        </view>

        <!-- å®˜æ–¹è§£æ -->
        <view class="analysis-section">
          <view class="analysis-header">
            <text class="analysis-icon">âœ¨</text>
            <text class="analysis-title">é‰´åˆ«è¦ç‚¹</text>
          </view>
          <text class="analysis-text">{{currentItem.explanation}}</text>
        </view>

        <view class="divider"></view>

        <!-- è¯„è®ºåŒº -->
        <view class="comments-section">
          <text class="comments-title">ç¤¾åŒºè®¨è®º ({{currentItem.comments.length}})</text>
          <view class="comments-list">
            <view wx:for="{{currentItem.comments}}" wx:key="id" wx:for-item="comment" class="comment-item">
              <image src="{{comment.avatar}}" class="comment-avatar"></image>
              <view class="comment-body">
                <view class="comment-header">
                  <text class="comment-user">{{comment.user}}</text>
                  <view wx:if="{{comment.isOfficial}}" class="official-badge">å®˜æ–¹</view>
                </view>
                <text class="comment-text">{{comment.text}}</text>
              </view>
              <view class="comment-likes">
                <text class="like-icon">â™¥</text>
                <text class="like-count">{{comment.likes}}</text>
              </view>
            </view>
          </view>
        </view>

        <view class="bottom-spacer"></view>
      </scroll-view>

      <!-- åº•éƒ¨æŒ‰é’® -->
      <view class="drawer-footer">
        <view class="next-button" bindtap="handleNext">
          <text>ç»§ç»­ä¸‹ä¸€é¢˜</text>
          <text class="arrow-icon">â†’</text>
        </view>
      </view>
    </view>
  </view>

</view>
