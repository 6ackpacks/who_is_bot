<!--pages/feed/feed.wxml-->
<view class="feed-container">
  <swiper class="feed-swiper" vertical duration="300" bindchange="onSwiperChange">
    <swiper-item wx:for="{{items}}" wx:key="id" class="feed-item">

      <!-- è§†é¢‘ç±»å‹ï¼šå…¨å±æ²‰æµ¸å¼ -->
      <block wx:if="{{item.type === 'video'}}">
        <view class="video-container">
          <video
            wx:if="{{item.url}}"
            id="video-{{index}}"
            src="{{item.url}}"
            class="full-video"
            loop
            autoplay="{{index === currentIndex}}"
            controls="{{false}}"
            object-fit="cover"
            binderror="onVideoError"
            bindplay="onVideoPlay"
            bindpause="onVideoPause"
          ></video>

          <!-- æš‚åœ/æ’­æ”¾æŒ‰é’® -->
          <view class="video-control" wx:if="{{index === currentIndex}}" bindtap="toggleVideoPlay" data-index="{{index}}">
            <view class="control-icon {{videoPlaying ? 'playing' : 'paused'}}">
              <text wx:if="{{!videoPlaying}}">â–¶</text>
              <text wx:else>âšâš</text>
            </view>
          </view>

          <view class="video-overlay">
            <text class="video-title">{{item.title}}</text>
          </view>
        </view>
      </block>

      <!-- å›¾ç‰‡/æ–‡æœ¬ç±»å‹ï¼šå¡ç‰‡æµ -->
      <block wx:else>
        <view class="card-container">
          <view class="card-content">
            <image wx:if="{{item.type === 'image'}}" src="{{item.url}}" mode="aspectFill" class="card-image"></image>
            <view class="card-text-area">
              <text class="card-title">{{item.title}}</text>
              <text class="card-desc" wx:if="{{item.text}}">{{item.text}}</text>
            </view>
          </view>
        </view>
      </block>

      <!-- åˆ¤å®šæŒ‰é’® -->
      <view class="action-bar" wx:if="{{viewState === 'judging'}}">
        <button class="btn btn-bot" bindtap="handleJudge" data-choice="ai">é“æ˜¯äººæœºï¼</button>
        <button class="btn btn-human" bindtap="handleJudge" data-choice="human">åŒ…çœŸäººçš„ï¼</button>
      </view>

      <!-- ç»“æœè¦†ç›–å±‚ -->
      <view wx:if="{{viewState === 'revealed' && index === currentIndex}}" class="result-overlay">
        <view class="result-icon {{isCorrect ? 'result-correct' : 'result-wrong'}}">
          <text class="result-icon-text">{{isCorrect ? 'âœ“' : 'âœ•'}}</text>
        </view>
        <view class="result-title">{{isCorrect ? 'æ…§çœ¼å¦‚ç‚¬' : 'é—æ†¾è¯¯åˆ¤'}}</view>
        <view class="result-subtitle">
          è¿™æ˜¯ç”± <text class="result-model">{{item.isAi ? item.modelTag : 'Human'}}</text> åˆ›ä½œçš„å†…å®¹
        </view>
        <view class="result-actions">
          <button class="result-btn result-btn-primary" bindtap="handleViewDetails">æŸ¥çœ‹è§£æ</button>
          <button class="result-btn result-btn-secondary" bindtap="handleNext">ä¸‹ä¸€é¢˜</button>
        </view>
      </view>

    </swiper-item>
  </swiper>

  <!-- è¯¦æƒ…é¡µé¢ï¼ˆä¿æŒåŸæœ‰çš„è¯¦æƒ…é¡µï¼‰ -->
  <view wx:if="{{viewState === 'details'}}" class="details-view">
    <!-- å¯¼èˆªæ  -->
    <view class="details-header">
      <view class="details-back" bindtap="handleBackToResult">
        <text class="back-icon">â€¹</text>
        <text class="back-text">è¿”å›</text>
      </view>
      <view class="details-title">çœŸç›¸è§£æ</view>
    </view>

    <scroll-view scroll-y class="details-content">
      <!-- ç»“æœæ‘˜è¦ -->
      <view class="details-summary">
        <view class="summary-header">
          <text class="summary-icon">{{isCorrect ? 'âœ“' : 'âœ•'}}</text>
          <text class="summary-title">{{isCorrect ? 'åˆ¤æ–­æ­£ç¡®' : 'åˆ¤æ–­é”™è¯¯'}}</text>
        </view>
        <view class="summary-text">
          è¯¥å†…å®¹ç¡®å®æ˜¯ <text class="summary-bold">{{currentItem.isAi ? 'AI ç”Ÿæˆ' : 'çœŸäººåˆ›ä½œ'}}</text>
        </view>
      </view>

      <!-- ç»Ÿè®¡æ¡ -->
      <view class="details-stats">
        <view class="stats-labels">
          <text class="stats-label-left">äººæœºæ„Ÿ {{currentItem.deceptionRate}}%</text>
          <text class="stats-label-right">çœŸå®æ„Ÿ {{100 - currentItem.deceptionRate}}%</text>
        </view>
        <view class="stats-bar-full">
          <view class="stats-fill-ai" style="width: {{currentItem.deceptionRate}}%"></view>
          <view class="stats-fill-human"></view>
        </view>
      </view>

      <!-- æä¾›è€…ä¿¡æ¯ -->
      <view class="provider-info">
        <text class="provider-label">æ¥æºæä¾›:</text>
        <view class="provider-badge">
          <image src="https://api.dicebear.com/7.x/avataaars/svg?seed={{currentItem.provider}}" class="provider-avatar"></image>
          <text class="provider-name">{{currentItem.provider}}</text>
        </view>
      </view>

      <!-- è¯¦ç»†è§£é‡Š -->
      <view class="explanation-box">
        <text class="explanation-icon">"</text>
        <view class="explanation-content">
          <view class="explanation-title">é‰´åˆ«è¦ç‚¹</view>
          <text class="explanation-text">{{currentItem.explanation}}</text>
          <view class="explanation-footer">
            <text class="explanation-label">ç”Ÿæˆæ¨¡å‹/æ¥æº</text>
            <text class="explanation-model">{{currentItem.isAi ? currentItem.modelTag : 'Human'}}</text>
          </view>
        </view>
      </view>

      <!-- ç¤¾åŒºè®¨è®º -->
      <view class="comments-section">
        <view class="comments-header">
          <text class="comments-icon">ğŸ’¬</text>
          <text class="comments-title">ç¤¾åŒºè®¨è®º</text>
        </view>

        <view class="comments-list">
          <view wx:for="{{currentItem.comments}}" wx:key="id" class="comment-item">
            <image src="{{item.avatar}}" class="comment-avatar"></image>
            <view class="comment-content">
              <view class="comment-header">
                <text class="comment-user">{{item.user}}</text>
                <view class="comment-likes">
                  <text class="like-icon">â™¥</text>
                  <text class="like-count">{{item.likes}}</text>
                </view>
              </view>
              <text class="comment-text">{{item.text}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- åº•éƒ¨å ä½ -->
      <view class="bottom-spacer"></view>
    </scroll-view>

    <!-- åº•éƒ¨æŒ‰é’® -->
    <view class="details-footer">
      <button class="next-btn" bindtap="handleNext">
        <text>ç»§ç»­æŒ‘æˆ˜ä¸‹ä¸€é¢˜</text>
        <text class="next-arrow">â†’</text>
      </button>
    </view>
  </view>

</view>
