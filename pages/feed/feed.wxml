<!--pages/feed/feed.wxml - æ–°ç‰ˆå¡ç‰‡å¼è®¾è®¡-->
<view class="feed-container">

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view wx:elif="{{error}}" class="error-container">
    <text class="error-icon">âš ï¸</text>
    <text class="error-text">{{error}}</text>
    <button class="retry-btn" bindtap="loadFeedData">é‡æ–°åŠ è½½</button>
  </view>

  <!-- ä¸»å†…å®¹åŒºåŸŸ - æ»šåŠ¨è§†å›¾ -->
  <scroll-view wx:else scroll-y="{{viewState !== 'judging'}}" class="feed-scroll">

    <!-- åˆ¤å®šå‰çŠ¶æ€ -->
    <view wx:if="{{viewState === 'judging'}}" class="judgment-view">

      <!-- æ ‡é¢˜ -->
      <view class="page-title">è°æ˜¯äººæœº?</view>

      <!-- å†…å®¹åŒºåŸŸï¼ˆå¼•å·+å¡ç‰‡ï¼‰ -->
      <view class="content-wrapper">
        <view class="quote-icon">"</view>

        <!-- è§†é¢‘å†…å®¹ -->
        <view wx:if="{{currentItem.type === 'video'}}" class="content-card image-card">
          <view class="content-image-wrapper">
            <video
              id="content-video"
              class="content-video"
              src="{{currentItem.url}}"
              object-fit="contain"
              show-center-play-btn="{{true}}"
              show-play-btn="{{false}}"
              controls="{{true}}"
              bindplay="onVideoPlay"
              bindpause="onVideoPause"
              binderror="onVideoError"
            ></video>
          </view>
        </view>

        <!-- å›¾ç‰‡å†…å®¹ -->
        <view wx:elif="{{currentItem.type === 'image'}}" class="content-card image-card">
          <view class="content-image-wrapper">
            <image class="content-image" src="{{currentItem.url}}" mode="aspectFit"></image>
          </view>
        </view>

        <!-- æ–‡å­—å†…å®¹ -->
        <view wx:else class="content-card">
          <text class="content-text">{{currentItem.text || currentItem.title}}</text>
        </view>
      </view>

      <!-- åˆ¤å®šæŒ‰é’® -->
      <view class="action-buttons">
        <button class="btn-judge btn-ai" bindtap="handleJudge" data-choice="ai">
          è¯¥æ˜¯äººæœº!
        </button>
        <button class="btn-judge btn-human" bindtap="handleJudge" data-choice="human">
          åŒ…çœŸäººçš„!
        </button>
      </view>

    </view>

    <!-- åˆ¤å®šåçŠ¶æ€ -->
    <view wx:elif="{{viewState === 'revealed'}}" class="result-view">

      <!-- ç»“æœæç¤º -->
      <view class="result-header">
        <text class="result-title">{{isCorrect ? 'ä½ çœŸæ˜¯åˆ«å…·æ…§çœ¼ï¼é€‰æ‹©ä¸ç»“æœä¸€è‡´ï¼' : 'å¾ˆé—æ†¾ï¼Œè¿™æ¬¡åˆ¤æ–­å¤±è¯¯äº†'}}</text>
      </view>

      <!-- ç»Ÿè®¡æ¡ -->
      <view class="stats-bar">
        <view class="stat-item stat-ai" style="width: {{currentItem.aiPercentage || 28}}%">
          <text class="stat-text">{{currentItem.aiPercentage || 28}}%</text>
        </view>
        <view class="stat-item stat-human" style="width: {{100 - (currentItem.aiPercentage || 28)}}%">
          <text class="stat-text">{{100 - (currentItem.aiPercentage || 28)}}%</text>
        </view>
      </view>

      <!-- æ¥æºä¿¡æ¯ -->
      <view class="source-info">
        è¯¥å†…å®¹æ˜¯ {{currentItem.isAi ? 'ğŸ¤– AI' : 'ğŸ‘¤ çœŸäºº'}} {{currentItem.provider}} æ•°æ®æä¾›ã€‚
      </view>

      <!-- å†…å®¹å¡ç‰‡ -->
      <view class="content-card-wrapper">
        <view class="quote-icon">"</view>

        <!-- è§†é¢‘å†…å®¹ -->
        <view wx:if="{{currentItem.type === 'video'}}" class="content-card image-card">
          <view class="content-image-wrapper">
            <video
              id="result-video"
              class="content-video"
              src="{{currentItem.url}}"
              object-fit="contain"
              show-center-play-btn="{{true}}"
              show-play-btn="{{false}}"
              controls="{{true}}"
              bindplay="onVideoPlay"
              bindpause="onVideoPause"
              binderror="onVideoError"
            ></video>
          </view>
        </view>

        <!-- å›¾ç‰‡å†…å®¹ -->
        <view wx:elif="{{currentItem.type === 'image'}}" class="content-card image-card">
          <view class="content-image-wrapper">
            <image class="content-image" src="{{currentItem.url}}" mode="aspectFit"></image>
          </view>
        </view>

        <!-- æ–‡å­—å†…å®¹ -->
        <view wx:else class="content-card">
          <text class="content-text">{{currentItem.text || currentItem.title}}</text>
        </view>
      </view>

      <!-- è§£æè¯´æ˜ -->
      <view wx:if="{{currentItem.explanation}}" class="explanation-box">
        <text class="explanation-label">è¯¥å†…å®¹æ˜¯ {{currentItem.modelTag}} ç”Ÿæˆ</text>
        <text class="explanation-text">{{currentItem.explanation}}</text>
      </view>

      <!-- ç¤¾åŒºåŒºåŸŸ -->
      <view class="community-section">
        <view class="community-header">
          <text class="community-title">ç¤¾åŒº</text>
        </view>

        <view class="community-card">
          <view class="community-avatar">ğŸ®</view>
          <view class="community-content">
            <text class="community-name">ç»§ç»­æŒ‘æˆ˜</text>
            <text class="community-desc">ä¼šåŠæ•°çš„ä½œå“è¿˜æœ‰äººä¸çŸ¥é“ï¼Œè¿˜æœ‰{{currentItem.aiPercentage || 28}}%çš„ä¸¤éš¾åº¦</text>
          </view>
        </view>
      </view>

      <!-- åº•éƒ¨æŒ‰é’® -->
      <view class="bottom-actions">
        <button class="btn-secondary" bindtap="goHome">è¿”å›ä¸»é¡µ</button>
        <button class="btn-primary" bindtap="handleNext">ç»§ç»­æŒ‘æˆ˜</button>
      </view>

    </view>

  </scroll-view>

</view>
