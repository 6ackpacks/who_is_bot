# 数据库使用说明

## 数据表结构

### Content 表 (content)

| 字段名 | 数据库字段名 | 类型 | 说明 | 必填 |
|--------|-------------|------|------|------|
| id | id | VARCHAR(36) | 主键，UUID格式 | ✅ |
| type | type | VARCHAR(20) | 内容类型：'text', 'image', 'video' | ✅ |
| url | url | TEXT | 图片/视频URL | ❌ |
| text | text | TEXT | 文本内容 | ❌ |
| title | title | VARCHAR(255) | 标题 | ✅ |
| isAi | is_bot | BOOLEAN | 是否为AI生成 (true=AI, false=人类) | ✅ |
| modelTag | modelTag | VARCHAR(100) | 模型标签 (如 'GPT-4', 'Claude', 'Human') | ✅ |
| provider | provider | VARCHAR(100) | 提供者 (如 'OpenAI', 'Anthropic', 'User') | ✅ |
| deceptionRate | deceptionRate | FLOAT | 欺骗率 (0-1，表示判断错误的比例) | ✅ |
| explanation | explanation | TEXT | 解释说明 | ✅ |
| createdAt | createdAt | TIMESTAMP | 创建时间 (自动生成) | - |
| updatedAt | updatedAt | TIMESTAMP | 更新时间 (自动生成) | - |

## 插入测试数据的方法

### 方法1: 使用SQL文件 (推荐)

1. 打开你的数据库管理工具 (如 MySQL Workbench, phpMyAdmin, DBeaver等)
2. 连接到你的数据库
3. 打开 `test-data.sql` 文件
4. 执行SQL脚本

```bash
# 如果使用命令行
mysql -u your_username -p your_database < test-data.sql
```

### 方法2: 使用TypeORM Repository

在你的NestJS后端服务中创建一个测试脚本：

```typescript
// scripts/seed-test-data.ts
import { NestFactory } from '@nestjs/core';
import { AppModule } from '../src/app.module';
import { ContentService } from '../src/content/content.service';

async function bootstrap() {
  const app = await NestFactory.createApplicationContext(AppModule);
  const contentService = app.get(ContentService);

  // 插入文本测试数据
  await contentService.create({
    id: 'test-text-ai-001',
    type: 'text',
    text: '你感受这个世界的波长与你周围的人不同步...',
    title: 'AI生成的哲学思考',
    isAi: true,
    modelTag: 'GPT-4',
    provider: 'OpenAI',
    deceptionRate: 0.72,
    explanation: '这段文字使用了典型的AI写作模式...'
  });

  // 插入图片测试数据
  await contentService.create({
    id: 'test-image-ai-001',
    type: 'image',
    url: 'https://picsum.photos/400/600?random=1',
    title: 'AI生成的风景画',
    isAi: true,
    modelTag: 'Midjourney',
    provider: 'Midjourney',
    deceptionRate: 0.81,
    explanation: 'AI生成的图片通常具有过于完美的构图...'
  });

  // 插入视频测试数据
  await contentService.create({
    id: 'test-video-ai-001',
    type: 'video',
    url: 'https://your-cloud-storage.com/test-video.mp4',
    title: 'AI生成的动画短片',
    isAi: true,
    modelTag: 'Runway Gen-2',
    provider: 'Runway',
    deceptionRate: 0.79,
    explanation: 'AI生成的视频通常在运动连贯性上存在问题...'
  });

  console.log('测试数据插入完成！');
  await app.close();
}

bootstrap();
```

运行脚本：
```bash
ts-node scripts/seed-test-data.ts
```

### 方法3: 使用API接口

如果你的后端已经有创建内容的API接口，可以使用Postman或curl：

```bash
curl -X POST http://your-api-url/content \
  -H "Content-Type: application/json" \
  -d '{
    "id": "test-text-ai-001",
    "type": "text",
    "text": "你感受这个世界的波长与你周围的人不同步...",
    "title": "AI生成的哲学思考",
    "isAi": true,
    "modelTag": "GPT-4",
    "provider": "OpenAI",
    "deceptionRate": 0.72,
    "explanation": "这段文字使用了典型的AI写作模式..."
  }'
```

## 测试数据说明

我已经在 `test-data.sql` 中准备了10条测试数据：

### 文本内容 (5条)
- ✅ AI生成的哲学思考 (欺骗率: 72%)
- ✅ 真人的日常碎碎念 (欺骗率: 35%)
- ✅ AI创作的现代诗 (欺骗率: 68%)
- ✅ 高难度：AI模仿口语 (欺骗率: 89%)
- ✅ 高难度：真人的正式写作 (欺骗率: 85%)

### 图片内容 (3条)
- ✅ AI生成的风景画 (欺骗率: 81%)
- ✅ 真人拍摄的街景 (欺骗率: 42%)
- ✅ AI生成的动漫角色 (欺骗率: 75%)

### 视频内容 (2条)
- ✅ AI生成的动画短片 (欺骗率: 79%)
- ✅ 真人拍摄的生活片段 (欺骗率: 38%)

## 重要提示

### 图片和视频URL
测试数据中的图片URL使用了 `picsum.photos` (随机图片服务)，视频URL是示例URL。

**你需要替换为真实的URL：**

1. **图片**: 上传到微信云存储或其他CDN
2. **视频**: 上传到微信云存储

### 上传到微信云存储的方法

```javascript
// 在小程序中上传文件
wx.cloud.uploadFile({
  cloudPath: 'test-images/ai-image-1.jpg',
  filePath: tempFilePath, // 本地文件路径
  success: res => {
    console.log('上传成功', res.fileID);
    // 使用 res.fileID 作为 url 字段的值
  }
});
```

### 更新测试数据中的URL

上传文件后，更新SQL中的URL：

```sql
UPDATE content
SET url = 'cloud://your-env.xxx/test-images/ai-image-1.jpg'
WHERE id = 'test-image-ai-001';
```

## 验证数据

插入数据后，运行以下查询验证：

```sql
-- 查看所有测试数据
SELECT id, type, title, is_bot, modelTag
FROM content
WHERE id LIKE 'test-%'
ORDER BY createdAt DESC;

-- 统计各类型数量
SELECT type, COUNT(*) as count
FROM content
WHERE id LIKE 'test-%'
GROUP BY type;

-- 查看AI vs 真人分布
SELECT is_bot, COUNT(*) as count
FROM content
WHERE id LIKE 'test-%'
GROUP BY is_bot;
```

## 前端显示字段映射

小程序前端使用的字段名与数据库字段名的对应关系：

| 前端字段 | 数据库字段 | 说明 |
|---------|-----------|------|
| currentItem.type | type | 内容类型 |
| currentItem.url | url | 图片/视频URL |
| currentItem.text | text | 文本内容 |
| currentItem.title | title | 标题 |
| currentItem.isAi | is_bot | 是否AI |
| currentItem.modelTag | modelTag | 模型标签 |
| currentItem.provider | provider | 提供者 |
| currentItem.aiPercentage | deceptionRate * 100 | AI判断百分比 |
| currentItem.explanation | explanation | 解释说明 |

## 常见问题

### Q: 为什么小程序还是显示Mock数据？
A: 确保 `utils/api.js` 中的 `useMock: false`

### Q: 如何清除测试数据？
A:
```sql
DELETE FROM content WHERE id LIKE 'test-%';
```

### Q: 视频无法播放？
A:
1. 检查视频URL是否可访问
2. 确保视频格式为微信小程序支持的格式 (MP4, M3U8)
3. 检查云存储权限设置

### Q: 图片显示不出来？
A:
1. 检查图片URL是否可访问
2. 确保小程序已配置合法域名
3. 检查云存储权限设置
