# 谁是人机？小程序配置指南

## 📋 项目概述

**项目名称**: 谁是人机？(Who is the Bot?)
**项目类型**: 微信小程序
**AppID**: wx75af0c6413e1d9e5
**功能**: AI生成内容识别游戏平台

---

## ⚠️ 当前问题分析

### 控制台错误

根据截图显示的错误信息：

1. **页面注册错误** (已解决 - 所有页面文件完整)
   - ✅ 所有5个页面已在 `app.json` 中正确注册
   - ✅ 所有页面文件 (.js, .json, .wxml, .wxss) 都存在
   - ✅ 所有页面都有正确的 `Page()` 调用

2. **可能的根本原因**
   - 编译缓存问题 - 需要清除缓存重新编译
   - 微信开发者工具版本问题
   - 项目配置文件可能需要重新加载

### 建议的修复步骤

1. **清除编译缓存**
   - 在微信开发者工具中：工具 → 清除缓存 → 清除全部缓存
   - 关闭并重新打开项目

2. **重新编译**
   - 点击"编译"按钮重新编译项目
   - 或使用快捷键 Ctrl+B (Windows) / Cmd+B (Mac)

3. **检查开发者工具版本**
   - 确保使用最新稳定版微信开发者工具
   - 当前项目使用的基础库版本: 3.13.1

---

## 🔧 必须配置的项目

### 1. API密钥配置 ⚠️ **必须**

**文件**: `.env.local`
**当前状态**: ❌ 使用占位符

```env
# 当前配置
GEMINI_API_KEY=PLACEHOLDER_API_KEY

# 需要修改为
GEMINI_API_KEY=你的实际API密钥
```

**获取方式**:
- 访问 Google AI Studio: https://makersuite.google.com/app/apikey
- 创建新的API密钥
- 替换 `.env.local` 中的占位符

---

### 2. 服务器域名白名单配置 ⚠️ **必须**

**配置位置**: 微信公众平台 → 开发 → 开发管理 → 开发设置 → 服务器域名

**需要添加的域名**:

| 域名类型 | 域名地址 | 用途 |
|---------|---------|------|
| request合法域名 | `https://picsum.photos` | 示例图片加载 |
| request合法域名 | `https://api.dicebear.com` | 头像生成服务 |
| request合法域名 | 你的后端API域名 | 数据接口（待实现） |

**开发阶段临时方案**:
- 在微信开发者工具中：设置 → 项目设置 → 本地设置
- 勾选"不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"

---

### 3. TabBar图标配置 🎨 **可选但推荐**

**当前状态**: ❌ 仅使用文字，无图标

**需要准备的图标** (共10个):

| 页面 | 普通状态图标 | 选中状态图标 | 尺寸要求 |
|-----|------------|------------|---------|
| 判定 (feed) | `images/tab-feed.png` | `images/tab-feed-active.png` | 81px × 81px |
| 榜单 (leaderboard) | `images/tab-leaderboard.png` | `images/tab-leaderboard-active.png` | 81px × 81px |
| 发布 (publish) | `images/tab-publish.png` | `images/tab-publish-active.png` | 81px × 81px |
| 广场 (square) | `images/tab-square.png` | `images/tab-square-active.png` | 81px × 81px |
| 我的 (profile) | `images/tab-profile.png` | `images/tab-profile-active.png` | 81px × 81px |

**配置方法**:

1. 将图标文件放入 `images/` 目录
2. 修改 `app.json` 中的 `tabBar.list` 配置：

```json
{
  "pagePath": "pages/feed/feed",
  "text": "判定",
  "iconPath": "images/tab-feed.png",
  "selectedIconPath": "images/tab-feed-active.png"
}
```

---

### 4. 后端服务配置 🚧 **待实现**

**当前状态**: ❌ 使用模拟数据 (`utils/mockData.js`)

**需要实现的服务**:

#### 4.1 用户认证服务
```javascript
// services/auth.js (需要创建)
- wx.login() 微信登录
- 获取用户信息
- Token管理
```

#### 4.2 数据服务
```javascript
// services/api.js (需要创建)
- getFeedData() - 获取判定内容
- submitJudgment() - 提交判定结果
- getLeaderboard() - 获取排行榜
- getUserProfile() - 获取用户资料
- updateUserStats() - 更新用户统计
```

#### 4.3 环境变量
需要在 `.env.local` 中添加：
```env
API_BASE_URL=https://your-api-domain.com
WECHAT_APP_ID=wx75af0c6413e1d9e5
WECHAT_APP_SECRET=你的AppSecret（注意安全）
```

---

## 📁 项目结构说明

### 核心配置文件

```
who-is-the-bot/
├── app.json                    # ✅ 全局配置（页面注册、TabBar、窗口样式）
├── app.js                      # ✅ 小程序入口（全局数据、生命周期）
├── app.wxss                    # ✅ 全局样式
├── project.config.json         # ✅ 开发者工具配置
├── project.private.config.json # ✅ 私有配置（热重载等）
├── .env.local                  # ⚠️ 环境变量（需要配置API密钥）
└── sitemap.json               # ✅ 搜索引擎索引配置
```

### 页面文件结构

每个页面包含4个文件：

```
pages/
├── feed/                       # ✅ 判定页面（功能完整）
│   ├── feed.js                # 页面逻辑
│   ├── feed.json              # 页面配置
│   ├── feed.wxml              # 页面结构
│   └── feed.wxss              # 页面样式
│
├── leaderboard/               # ✅ 排行榜页面（功能完整）
├── profile/                   # ✅ 个人资料页面（功能完整）
├── publish/                   # 🚧 发布页面（占位符）
└── square/                    # 🚧 广场页面（占位符）
```

---

## ✅ 已完成的配置

- ✅ 页面注册 (app.json)
- ✅ TabBar导航配置
- ✅ 窗口样式配置
- ✅ 全局样式定义
- ✅ 模拟数据系统
- ✅ 基础页面结构
- ✅ 项目配置文件

---

## 🚀 快速启动步骤

### 1. 安装依赖
```bash
npm install
```

### 2. 配置API密钥
编辑 `.env.local` 文件，替换 `PLACEHOLDER_API_KEY`

### 3. 打开微信开发者工具
- 导入项目
- 选择项目目录: `C:\Users\li\Downloads\who-is-the-bot`
- AppID: wx75af0c6413e1d9e5

### 4. 开发阶段设置
- 勾选"不校验合法域名"（本地设置）
- 清除缓存并重新编译

### 5. 编译运行
- 点击"编译"按钮
- 在模拟器中测试功能

---

## 🔍 功能实现状态

| 页面 | 状态 | 功能说明 |
|-----|------|---------|
| 判定 (Feed) | ✅ 完整 | 显示内容、用户判定、结果反馈、统计更新 |
| 排行榜 (Leaderboard) | ✅ 完整 | AI模型排名、类型筛选、欺骗率展示 |
| 个人资料 (Profile) | ✅ 完整 | 用户信息、统计数据、成就系统 |
| 发布 (Publish) | 🚧 占位 | 仅有返回首页功能，上传功能待实现 |
| 广场 (Square) | 🚧 占位 | 空页面，社区功能待实现 |

---

## 📝 待实现功能清单

### 高优先级
1. ⚠️ 替换 `.env.local` 中的API密钥
2. ⚠️ 配置服务器域名白名单
3. 🔧 实现真实的后端API服务
4. 🔧 实现微信登录认证

### 中优先级
5. 🎨 添加TabBar图标
6. 📤 实现发布页面功能（上传样本）
7. 💬 实现广场页面功能（社区讨论）
8. 💾 实现数据持久化

### 低优先级
9. 🎯 优化用户体验
10. 📊 添加数据分析
11. 🏆 完善成就系统
12. 🔔 添加消息通知

---

## 🐛 故障排除

### 问题1: 页面注册错误
**症状**: 控制台显示 "Page has not been registered yet"
**解决方案**:
1. 清除微信开发者工具缓存
2. 重新编译项目
3. 检查页面文件是否完整（.js, .json, .wxml, .wxss）

### 问题2: 网络请求失败
**症状**: 图片加载失败、API调用失败
**解决方案**:
1. 开发阶段：勾选"不校验合法域名"
2. 生产环境：在微信公众平台配置服务器域名白名单

### 问题3: API密钥无效
**症状**: Gemini API调用失败
**解决方案**:
1. 检查 `.env.local` 中的API密钥是否正确
2. 确认API密钥有效且未过期
3. 检查API配额是否用尽

---

## 📞 技术支持

- **微信开发者文档**: https://developers.weixin.qq.com/miniprogram/dev/framework/
- **项目问题反馈**: 在项目目录创建 issue
- **开发者工具下载**: https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html

---

## 📄 许可证

本项目配置指南基于项目实际代码分析生成。

**最后更新**: 2026-01-22
