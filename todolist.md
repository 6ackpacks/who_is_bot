# Who-is-Bot 后端开发路径

## 开发顺序（按优先级和依赖关系）

### 阶段1：基础功能 ✅
- [x] 数据库设计和创建
- [x] 项目结构搭建
- [x] 基础配置（TypeORM, 环境变量）

### 阶段2：用户系统 🔄
**优先级：最高（其他功能都依赖用户系统）**

#### 2.1 微信登录
- [ ] 实现微信登录接口 `/auth/login`
  - 接收微信 code
  - 调用微信 API 获取 openid
  - 创建或更新用户
  - 返回用户信息和 token（如果需要）

- [ ] 实现用户信息获取 `/user/profile`
  - 根据 uid 获取用户信息
  - 返回用户统计数据

#### 2.2 游客支持
- [ ] 游客ID管理（前端已实现）
- [ ] 游客数据统计（可选）

**测试标准：**
- 用户能成功登录
- 用户信息正确显示
- 游客能正常使用基础功能

---

### 阶段3：内容系统 ✅
**优先级：高**

- [x] 内容列表接口 `/content/feed`
- [x] 内容详情接口 `/content/:id`
- [ ] 修复视频URL问题（云存储 vs 真实URL）

**当前状态：** 基本完成，需要修复视频URL

---

### 阶段4：判定系统 ⚠️
**优先级：高（核心功能）**

#### 4.1 判定提交
- [ ] 修复 `/judgment/submit` 接口（当前500错误）
  - 验证用户/游客身份
  - 记录判定结果
  - 更新用户统计
  - 更新内容投票数

#### 4.2 判定统计
- [ ] 用户判定历史
- [ ] 准确率计算
- [ ] 连胜记录

**测试标准：**
- 用户能提交判定
- 统计数据正确更新
- 连胜逻辑正确

---

### 阶段5：评论系统 ✅
**优先级：中**

- [x] 创建评论 `/comments` POST
- [x] 获取评论 `/comments` GET
- [x] 点赞评论 `/comments/:id/like`
- [x] 删除评论 `/comments/:id` DELETE
- [x] 回复评论（嵌套评论）

**当前状态：** 已完成，但小程序端还有404错误需要排查

---

### 阶段6：排行榜系统 ⚠️
**优先级：中**

- [ ] 全球排行榜 `/leaderboard/global`
  - 按总判定数排序
  - 按准确率排序
  - 按连胜数排序

- [ ] 周排行榜 `/leaderboard/weekly`
  - 周统计数据
  - 自动重置逻辑（已有定时任务）

**测试标准：**
- 排行榜数据正确
- 排序逻辑正确
- 周重置功能正常

---

### 阶段7：成就系统 📋
**优先级：低**

- [ ] 获取成就列表 `/achievements`
- [ ] 获取用户成就 `/achievements/user/:userId`
- [ ] 成就解锁逻辑
  - 判定数成就
  - 准确率成就
  - 连胜成就

**测试标准：**
- 成就正确解锁
- 成就进度正确显示

---

### 阶段8：创作者中心 📋
**优先级：低（Beta功能）**

- [ ] 内容上传接口
- [ ] 内容审核
- [ ] 创作者权限管理

---

## 当前状态总结

### ✅ 已完成
1. 数据库设计和创建
2. 内容系统（基本功能）
3. 评论系统（后端API）

### ⚠️ 需要修复
1. **判定系统** - 500错误，需要立即修复
2. **评论系统** - 小程序端404错误
3. **视频URL** - 云存储URL无法访问

### 📋 待开发
1. **微信登录** - 最高优先级
2. **排行榜** - 中优先级
3. **成就系统** - 低优先级

---

## 建议的下一步行动

### 立即执行（今天）
1. ✅ 修复评论系统的小程序404问题
2. 🔄 实现微信登录功能
3. 🔄 修复判定系统500错误

### 短期目标（本周）
1. 完成用户系统
2. 完成判定系统
3. 测试核心流程（登录 -> 浏览内容 -> 判定 -> 查看结果 -> 评论）

### 中期目标（下周）
1. 实现排行榜
2. 实现成就系统
3. 优化性能和用户体验

---

## 技术债务清单

1. **外键约束** - 数据库没有外键，需要在应用层严格维护数据一致性
2. **错误处理** - 需要统一的错误处理和日志记录
3. **视频存储** - 需要决定使用云存储还是外部URL
4. **认证机制** - 需要实现JWT或session管理
5. **数据验证** - 需要完善DTO验证规则

---

## 开发规范

1. **先读后写** - 修改代码前先阅读相关代码
2. **测试驱动** - 每个功能完成后立即测试
3. **文档同步** - 更新 DATABASE_SCHEMA.md
4. **错误处理** - 所有API都要有适当的错误处理
5. **日志记录** - 关键操作要记录日志
